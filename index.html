<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â§´Â©¶„ÅÆÂÖ±ÊúâTODO„É™„Çπ„Éà</title>
    <!-- Google API Client Library -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #fff5e6;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        /* „Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ËÉåÊôØ */
        .gradient-bg {
            background: linear-gradient(135deg, #ff9a8b 0%, #ff6a88 50%, #ff99ac 100%);
        }

        /* „Éò„ÉÉ„ÉÄ„Éº */
        .header {
            background: linear-gradient(135deg, #ff9a8b 0%, #ff6a88 50%, #ff99ac 100%);
            padding: 24px;
            border-radius: 0 0 24px 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
            color: white;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* „Ç≥„É≥„ÉÜ„Éä */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 16px;
        }

        /* „Éú„Çø„É≥ */
        .btn {
            border: none;
            cursor: pointer;
            font-family: 'Noto Sans JP', sans-serif;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            background: linear-gradient(to right, #ff6a88, #ff99ac);
            color: white;
            padding: 16px 24px;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(255, 106, 136, 0.3);
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .btn-primary:hover {
            box-shadow: 0 6px 16px rgba(255, 106, 136, 0.4);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: #e5e7eb;
            color: #374151;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 500;
        }

        .btn-secondary:hover {
            background-color: #d1d5db;
        }

        .btn-calendar {
            background: linear-gradient(to right, #fb923c, #f472b6);
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            font-weight: 500;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
            box-shadow: 0 2px 8px rgba(251, 146, 60, 0.3);
        }

        .btn-calendar:hover {
            box-shadow: 0 4px 12px rgba(251, 146, 60, 0.4);
        }



        .btn-delete {
            background: linear-gradient(to right, #ef4444, #dc2626);
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            font-weight: 500;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
        }

        .btn-delete:hover {
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
            background: linear-gradient(to right, #dc2626, #b91c1c);
        }



        /* „Éï„Ç©„Éº„É† */
        .task-form {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }

        .task-form h2 {
            font-size: 20px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 16px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Noto Sans JP', sans-serif;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #f472b6;
        }

        .assignee-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .assignee-btn {
            padding: 12px 16px;
            border-radius: 12px;
            background-color: #f3f4f6;
            color: #374151;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .assignee-btn:hover {
            background-color: #e5e7eb;
        }

        .assignee-btn.active {
            background: linear-gradient(135deg, #f472b6, #a78bfa);
            color: white;
            box-shadow: 0 2px 8px rgba(244, 114, 182, 0.3);
        }

        .form-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        /* „Çø„Çπ„ÇØ„Ç´„Éº„Éâ */
        .task-card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .task-card.completed {
            opacity: 0.6;
        }

        .task-content {
            display: flex;
            align-items: start;
            gap: 12px;
        }

        .checkbox {
            flex-shrink: 0;
            width: 32px;
            height: 32px;
            border: 2px solid #d1d5db;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox:hover {
            border-color: #f472b6;
        }

        .checkbox.checked {
            background: linear-gradient(135deg, #f472b6, #a78bfa);
            border-color: #f472b6;
        }

        .task-info {
            flex: 1;
        }

        .task-title {
            font-size: 18px;
            font-weight: 500;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .task-title.completed {
            text-decoration: line-through;
            color: #9ca3af;
        }

        .task-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .task-date {
            font-size: 14px;
            color: #6b7280;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .task-assignee {
            font-size: 12px;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 500;
        }

        .assignee-husband {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .assignee-wife {
            background-color: #fce7f3;
            color: #be185d;
        }

        .assignee-both {
            background-color: #f3e8ff;
            color: #6b21a8;
        }

        /* „Çµ„Éñ„Çø„Çπ„ÇØÈñ¢ÈÄ£ */
        .subtask-toggle-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            transition: all 0.3s ease;
            border-radius: 4px;
        }

        .subtask-toggle-btn:hover {
            background-color: #f3f4f6;
            color: #f472b6;
        }

        .subtask-toggle-btn.expanded {
            transform: rotate(180deg);
        }

        .subtask-progress-container {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .subtask-progress-bar {
            flex: 1;
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .subtask-progress-fill {
            height: 100%;
            background: linear-gradient(to right, #f472b6, #a78bfa);
            transition: width 0.5s ease;
        }

        .subtask-progress-text {
            font-size: 12px;
            font-weight: 600;
            color: #f472b6;
            min-width: 36px;
            text-align: right;
        }

        .subtasks-container {
            margin-top: 12px;
            padding: 12px;
            background-color: #f9fafb;
            border-radius: 8px;
            border-left: 3px solid #f472b6;
        }

        .subtask-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            margin-bottom: 4px;
            border-radius: 6px;
            transition: background-color 0.3s ease;
        }

        .subtask-item:hover {
            background-color: #ffffff;
        }

        .subtask-item.completed {
            opacity: 0.6;
        }

        .subtask-checkbox {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .subtask-checkbox:hover {
            border-color: #f472b6;
        }

        .subtask-checkbox.checked {
            background: linear-gradient(135deg, #f472b6, #a78bfa);
            border-color: #f472b6;
        }

        .subtask-checkbox svg {
            width: 14px;
            height: 14px;
        }

        .subtask-title {
            flex: 1;
            font-size: 14px;
            color: #374151;
        }

        .subtask-title.completed {
            text-decoration: line-through;
            color: #9ca3af;
        }

        .subtask-assignee {
            font-size: 11px;
            padding: 3px 10px;
            border-radius: 10px;
            font-weight: 500;
            margin-left: auto;
            flex-shrink: 0;
        }


        .task-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .btn-add-subtask {
            background: linear-gradient(to right, #a78bfa, #c084fc);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(167, 139, 250, 0.2);
        }

        .btn-add-subtask:hover {
            box-shadow: 0 4px 8px rgba(167, 139, 250, 0.3);
            transform: translateY(-1px);
        }

        .btn-add-subtask svg {
            width: 16px;
            height: 16px;
        }


        /* „Çª„ÇØ„Ç∑„Éß„É≥ */
        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #374151;
            margin-bottom: 12px;
            margin-top: 24px;
        }

        .empty-state {
            text-align: center;
            padding: 48px 24px;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .empty-state-text {
            color: #6b7280;
            font-weight: 500;
        }

        /* „Éú„Éà„É†„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            border-top: 1px solid #e5e7eb;
            padding: 12px 0;
            z-index: 100;
        }

        .nav-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .nav-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 24px;
            border-radius: 12px;
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-button.active {
            background: linear-gradient(135deg, #ff6a88, #ff9a8b);
            color: white;
        }

        .nav-button span {
            font-size: 12px;
            font-weight: 500;
        }

        /* „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Áµ±Ë®àÊÉÖÂ†± */
        .stats-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 16px;
        }

        .stats-card h3 {
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 16px;
        }

        .progress-bar {
            position: relative;
            height: 32px;
            background-color: #e5e7eb;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(to right, #f472b6, #a78bfa);
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(to right, #f472b6, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            text-align: center;
        }

        .stat-item-number {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
        }

        .stat-item-number.green {
            color: #10b981;
        }

        .stat-item-number.orange {
            color: #f59e0b;
        }

        .stat-item-label {
            font-size: 14px;
            color: #6b7280;
        }

        .assignee-stats {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .assignee-stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .assignee-stat-label {
            color: #374151;
        }

        .assignee-stat-number {
            font-size: 20px;
            font-weight: 700;
        }

        .message-card {
            margin-top: 24px;
            background: linear-gradient(135deg, #fce7f3, #f3e8ff);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
        }

        .message-card p:first-child {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .message-card p:last-child {
            font-size: 14px;
            color: #4b5563;
        }

        /* „Ç´„É¨„É≥„ÉÄ„Éº„Çø„Éñ */
        .calendar-item {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 16px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .time-label {
            font-size: 14px;
            font-weight: 700;
            color: #f472b6;
        }

        .calendar-date {
            font-size: 14px;
            color: #6b7280;
        }

        .calendar-title {
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .calendar-assignee {
            font-size: 14px;
            color: #4b5563;
        }

        /* „Ç´„É¨„É≥„ÉÄ„Éº„Ç¶„Ç£„Ç∏„Çß„ÉÉ„Éà */
        .calendar-widget {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .calendar-header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-month-title {
            font-size: 20px;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }

        .calendar-nav-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            color: #6b7280;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-nav-btn:hover {
            background-color: #f3f4f6;
            color: #f472b6;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 8px;
        }

        .calendar-weekday {
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            color: #6b7280;
            padding: 8px 4px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background-color: #f9fafb;
            border: 2px solid transparent;
        }

        .calendar-day:not(.empty):hover {
            background-color: #fce7f3;
            border-color: #f9a8d4;
        }

        .calendar-day.empty {
            cursor: default;
            background-color: transparent;
        }

        .calendar-day.today {
            background-color: #fef3c7;
            border-color: #fbbf24;
        }

        .calendar-day.selected {
            background: linear-gradient(135deg, #f472b6, #a78bfa);
            border-color: #f472b6;
        }

        .calendar-day.selected .calendar-day-number {
            color: white;
            font-weight: 700;
        }

        .calendar-day.selected .calendar-task-indicator {
            color: white;
        }

        .calendar-day-number {
            font-size: 16px;
            font-weight: 500;
            color: #1f2937;
        }

        .calendar-task-indicator {
            position: absolute;
            bottom: 4px;
            font-size: 8px;
            color: #f472b6;
            font-weight: 900;
        }

        .calendar-day.has-tasks {
            font-weight: 600;
        }


        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100%) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        @keyframes task-pop {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .confetti {
            animation: confetti-fall 1s ease-out;
        }

        .task-complete {
            animation: task-pop 0.5s ease-out;
        }

        .confetti-container {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 9999;
        }

        .confetti-item {
            position: absolute;
            font-size: 36px;
        }

        /* ÈùûË°®Á§∫„ÇØ„É©„Çπ */
        .hidden {
            display: none !important;
        }

        /* „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ */
        .login-overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-card {
            background: white;
            border-radius: 24px;
            padding: 40px 32px;
            width: 100%;
            max-width: 380px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .login-emoji {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .login-title {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .login-subtitle {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 32px;
        }

        .login-input-wrapper {
            position: relative;
            margin-bottom: 16px;
        }

        .login-input {
            width: 100%;
            padding: 14px 48px 14px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Noto Sans JP', sans-serif;
            outline: none;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .login-input:focus {
            border-color: #764ba2;
        }

        .login-toggle-pw {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #9ca3af;
            font-size: 18px;
            padding: 4px;
        }

        .login-remember {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 24px;
            font-size: 14px;
            color: #4b5563;
            cursor: pointer;
        }

        .login-remember input {
            width: auto;
            cursor: pointer;
            accent-color: #764ba2;
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            font-family: 'Noto Sans JP', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(118, 75, 162, 0.4);
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(118, 75, 162, 0.5);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .login-error {
            color: #ef4444;
            font-size: 14px;
            margin-top: 12px;
            min-height: 20px;
        }

        .login-shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            20% {
                transform: translateX(-10px);
            }

            40% {
                transform: translateX(10px);
            }

            60% {
                transform: translateX(-10px);
            }

            80% {
                transform: translateX(10px);
            }
        }
    </style>
</head>

<body>
    <!-- „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ -->
    <div id="loginScreen" class="login-overlay">
        <div class="login-card" id="loginCard">
            <div class="login-emoji">üîí</div>
            <h1 class="login-title">Â§´Â©¶„ÅÆÂÖ±ÊúâTODO</h1>
            <p class="login-subtitle">„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
            <div class="login-input-wrapper">
                <input type="password" id="loginPassword" class="login-input" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ"
                    onkeydown="if(event.key==='Enter') checkPassword()" autocomplete="current-password">
                <button class="login-toggle-pw" onclick="togglePasswordVisibility()" type="button">üëÅ</button>
            </div>
            <label class="login-remember">
                <input type="checkbox" id="rememberMe" checked>
                Ê¨°Âõû„Åã„ÇâËá™Âãï„É≠„Ç∞„Ç§„É≥
            </label>
            <button class="login-btn" onclick="checkPassword()">„É≠„Ç∞„Ç§„É≥</button>
            <div class="login-error" id="loginError"></div>
        </div>
    </div>

    <div id="app"></div>

    <script>
        // ===== „Éë„Çπ„ÉØ„Éº„ÉâË™çË®º =====
        // „Éë„Çπ„ÉØ„Éº„Éâ„ÅÆSHA-256„Éè„ÉÉ„Ç∑„É•ÂÄ§Ôºà„ÇΩ„Éº„Çπ„Ç≥„Éº„Éâ„Åã„ÇâÂÖÉ„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ„ÅØÂàÜ„Åã„Çä„Åæ„Åõ„ÇìÔºâ
        // „Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂ§âÊõ¥„Åô„ÇãÂ†¥Âêà„ÅØ„ÄÅÊñ∞„Åó„ÅÑ„Éë„Çπ„ÉØ„Éº„Éâ„ÅÆSHA-256„Éè„ÉÉ„Ç∑„É•„Çí„Åì„Åì„Å´Ë®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ
        const APP_PASSWORD_HASH = '111a4e2814556f81ff22256f0bba15e20921c316ac5e4950a6f00643f9834932';
        const AUTH_STORAGE_KEY = 'todo_auth_token';
        const AUTH_EXPIRY_DAYS = 30; // Ëá™Âãï„É≠„Ç∞„Ç§„É≥„ÅÆÊúâÂäπÊúüÈñìÔºàÊó•Êï∞Ôºâ

        // SHA-256„Éè„ÉÉ„Ç∑„É•„ÇíË®àÁÆó„Åô„ÇãÈñ¢Êï∞
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function checkPassword() {
            const input = document.getElementById('loginPassword');
            const error = document.getElementById('loginError');
            const card = document.getElementById('loginCard');

            const inputHash = await sha256(input.value);

            if (inputHash === APP_PASSWORD_HASH) {
                // „ÄåÊ¨°Âõû„Åã„ÇâËá™Âãï„É≠„Ç∞„Ç§„É≥„Äç„Åå„ÉÅ„Çß„ÉÉ„ÇØ„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà
                const rememberMe = document.getElementById('rememberMe').checked;
                if (rememberMe) {
                    const expiry = new Date();
                    expiry.setDate(expiry.getDate() + AUTH_EXPIRY_DAYS);
                    const authData = {
                        authenticated: true,
                        expiry: expiry.toISOString()
                    };
                    localStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(authData));
                }

                // „É≠„Ç∞„Ç§„É≥ÁîªÈù¢„ÇíÈùûË°®Á§∫
                document.getElementById('loginScreen').style.display = 'none';
                error.textContent = '';
            } else {
                error.textContent = '„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈÅï„ÅÑ„Åæ„Åô';
                card.classList.add('login-shake');
                setTimeout(() => card.classList.remove('login-shake'), 500);
                input.value = '';
                input.focus();
            }
        }

        function togglePasswordVisibility() {
            const input = document.getElementById('loginPassword');
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        function checkAutoLogin() {
            try {
                const stored = localStorage.getItem(AUTH_STORAGE_KEY);
                if (stored) {
                    const data = JSON.parse(stored);
                    if (data.authenticated && new Date(data.expiry) > new Date()) {
                        // ÊúâÂäπÊúüÈôêÂÜÖ„Å™„ÅÆ„ÅßËá™Âãï„É≠„Ç∞„Ç§„É≥
                        document.getElementById('loginScreen').style.display = 'none';
                        return true;
                    } else {
                        // ÊúüÈôêÂàá„Çå„Å™„ÅÆ„ÅßÂâäÈô§
                        localStorage.removeItem(AUTH_STORAGE_KEY);
                    }
                }
            } catch (e) {
                console.error('Ëá™Âãï„É≠„Ç∞„Ç§„É≥„Ç®„É©„Éº:', e);
            }
            return false;
        }

        function logout() {
            localStorage.removeItem(AUTH_STORAGE_KEY);
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('loginPassword').value = '';
            document.getElementById('loginError').textContent = '';
        }

        // Ëá™Âãï„É≠„Ç∞„Ç§„É≥„ÉÅ„Çß„ÉÉ„ÇØ
        checkAutoLogin();

        // Google Calendar APIË®≠ÂÆö
        const GOOGLE_CLIENT_ID = '524794726764-id6vmg4q2vt5s9j3i9n1dnj6p9sqiasd.apps.googleusercontent.com';
        const GOOGLE_API_KEY = 'AIzaSyDNmOjBA8Pv0wtyRuG0PJQGrdYQT_J7UFo'
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';
        const SCOPES = 'https://www.googleapis.com/auth/calendar.events';

        let tokenClient;
        let gapiInited = false;
        let gisInited = false;

        // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆÁä∂ÊÖã
        const state = {
            tasks: [
                {
                    id: 1,
                    title: 'Êô©„Åî„ÅØ„Çì„ÅÆÊùêÊñô„ÇíË≤∑„ÅÜ',
                    date: '2026-02-11',
                    assignee: 'Â¶ª',
                    completed: false,
                    subtasks: [
                        { id: 101, title: 'ÈáéËèú„ÇíË≤∑„ÅÜ', completed: false, assignee: 'Â¶ª' },
                        { id: 102, title: 'ËÇâ„ÇíË≤∑„ÅÜ', completed: false, assignee: 'Â¶ª' },
                        { id: 103, title: 'Ë™øÂë≥Êñô„ÇíË≤∑„ÅÜ', completed: false, assignee: 'Â¶ª' }
                    ]
                },
                {
                    id: 2,
                    title: '„Ç¥„ÉüÂá∫„Åó',
                    date: '2026-02-12',
                    assignee: 'Â§´',
                    completed: false,
                    subtasks: []
                },
                {
                    id: 3,
                    title: 'Êò†Áîª„ÇíË¶ã„Å´Ë°å„Åè',
                    date: '2026-02-15',
                    assignee: '‰∫å‰∫∫',
                    completed: false,
                    subtasks: [
                        { id: 301, title: '„ÉÅ„Ç±„ÉÉ„Éà‰∫àÁ¥Ñ', completed: false, assignee: 'Â§´' },
                        { id: 302, title: '„É¨„Çπ„Éà„É©„É≥‰∫àÁ¥Ñ', completed: false, assignee: 'Â¶ª' }
                    ]
                }
            ],
            activeTab: 'tasks',
            showForm: false,
            currentMonth: new Date(),
            selectedDate: null,
            expandedTasks: {},
            isGoogleSignedIn: false,
            formData: {
                title: '',
                date: '',
                assignee: '‰∫å‰∫∫',
                isAllDay: true,
                startTime: '09:00',
                endTime: '10:00'
            }
        };

        // SVG„Ç¢„Ç§„Ç≥„É≥
        const icons = {
            plus: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',
            check: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',
            calendar: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>',
            list: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>',
            settings: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v6m0 6v6m5.66-13.66l-4.24 4.24m0 6l-4.24 4.24m13.66-5.66l-6 0m-6 0l-6 0m13.66 5.66l-4.24-4.24m0-6l-4.24-4.24"></path></svg>',
            heart: '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>',
            chevronLeft: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>',
            chevronRight: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>',
            chevronDown: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>'
        };

        // Google„Ç´„É¨„É≥„ÉÄ„Éº„É™„É≥„ÇØÁîüÊàêÔºàÁµÇÊó• or ÊôÇÂàªÊåáÂÆöÔºâ
        function generateGoogleCalendarLink(task) {
            const baseUrl = 'https://calendar.google.com/calendar/render';
            const date = task.date.replace(/-/g, '');

            let datesParam;
            if (task.isAllDay === false && task.startTime && task.endTime) {
                // ÊôÇÂàªÊåáÂÆö„Ç§„Éô„É≥„Éà
                const startTime = task.startTime.replace(':', '') + '00';
                const endTime = task.endTime.replace(':', '') + '00';
                datesParam = `${date}T${startTime}/${date}T${endTime}`;
            } else {
                // ÁµÇÊó•„Ç§„Éô„É≥„Éà
                datesParam = `${date}/${date}`;
            }

            const params = new URLSearchParams({
                action: 'TEMPLATE',
                text: task.title,
                dates: datesParam,
                details: `ÊãÖÂΩì: ${task.assignee}`,
                location: '',
                trp: 'false'
            });

            return `${baseUrl}?${params.toString()}`;
        }

        // Google„Ç´„É¨„É≥„ÉÄ„Éº„Å´ËøΩÂä†ÔºàAPI‰ΩøÁî® or „É™„É≥„ÇØÔºâ
        function addToGoogleCalendar(task) {
            if (state.isGoogleSignedIn) {
                // API„ÅßËá™ÂãïËøΩÂä†
                createCalendarEvent(task);
            } else {
                // „É™„É≥„ÇØ„ÅßÈñã„Åè
                const url = generateGoogleCalendarLink(task);
                window.open(url, '_blank');
            }
        }

        // Google APIÂàùÊúüÂåñ
        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }

        async function initializeGapiClient() {
            await gapi.client.init({
                apiKey: GOOGLE_API_KEY,
                discoveryDocs: [DISCOVERY_DOC],
            });
            gapiInited = true;
            maybeEnableButtons();
        }

        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: GOOGLE_CLIENT_ID,
                scope: SCOPES,
                callback: '', // Âæå„ÅßÂÆöÁæ©
            });
            gisInited = true;
            maybeEnableButtons();
        }

        function maybeEnableButtons() {
            if (gapiInited && gisInited) {
                console.log('Google APIÊ∫ñÂÇôÂÆå‰∫Ü');
            }
        }

        // Google„Çµ„Ç§„É≥„Ç§„É≥
        function handleAuthClick() {
            tokenClient.callback = async (resp) => {
                if (resp.error !== undefined) {
                    throw (resp);
                }
                state.isGoogleSignedIn = true;
                render();
            };

            if (gapi.client.getToken() === null) {
                tokenClient.requestAccessToken({ prompt: 'consent' });
            } else {
                tokenClient.requestAccessToken({ prompt: '' });
            }
        }

        // Google„Çµ„Ç§„É≥„Ç¢„Ç¶„Éà
        function handleSignoutClick() {
            const token = gapi.client.getToken();
            if (token !== null) {
                google.accounts.oauth2.revoke(token.access_token);
                gapi.client.setToken('');
                state.isGoogleSignedIn = false;
                render();
            }
        }

        // „Ç´„É¨„É≥„ÉÄ„Éº„Ç§„Éô„É≥„Éà‰ΩúÊàê
        async function createCalendarEvent(task) {
            try {
                let startDateTime, endDateTime;

                if (task.isAllDay === false && task.startTime && task.endTime) {
                    // ÊôÇÂàªÊåáÂÆö
                    startDateTime = `${task.date}T${task.startTime}:00`;
                    endDateTime = `${task.date}T${task.endTime}:00`;
                } else {
                    // ÁµÇÊó•
                    startDateTime = task.date;
                    endDateTime = task.date;
                }

                const event = {
                    'summary': task.title,
                    'description': `ÊãÖÂΩì: ${task.assignee}`,
                    'start': task.isAllDay === false && task.startTime ?
                        { 'dateTime': startDateTime, 'timeZone': 'Asia/Tokyo' } :
                        { 'date': startDateTime },
                    'end': task.isAllDay === false && task.endTime ?
                        { 'dateTime': endDateTime, 'timeZone': 'Asia/Tokyo' } :
                        { 'date': endDateTime }
                };

                const request = await gapi.client.calendar.events.insert({
                    'calendarId': 'primary',
                    'resource': event
                });

                console.log('„Ç§„Éô„É≥„Éà‰ΩúÊàêÊàêÂäü:', request.result);
                alert('‚úÖ Google„Ç´„É¨„É≥„ÉÄ„Éº„Å´ËøΩÂä†„Åó„Åæ„Åó„ÅüÔºÅ');
            } catch (err) {
                console.error('„Ç§„Éô„É≥„Éà‰ΩúÊàê„Ç®„É©„Éº:', err);
                alert('‚ùå „Ç´„É¨„É≥„ÉÄ„Éº„Å∏„ÅÆËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„Çµ„Ç§„É≥„Ç§„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }
        }

        // Á¥ôÂêπÈõ™„Ç®„Éï„Çß„ÇØ„Éà
        function showConfetti() {
            const container = document.createElement('div');
            container.className = 'confetti-container';
            document.body.appendChild(container);

            const emojis = ['üéâ', '‚ú®', 'üéä', 'üíï', 'üåü'];
            for (let i = 0; i < 20; i++) {
                const item = document.createElement('div');
                item.className = 'confetti-item confetti';
                item.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                item.style.left = `${Math.random() * 100}%`;
                item.style.top = '-50px';
                item.style.animationDelay = `${Math.random() * 0.3}s`;
                container.appendChild(item);
            }

            setTimeout(() => {
                document.body.removeChild(container);
            }, 1000);
        }

        // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏Ê©üËÉΩ
        const STORAGE_KEY = 'todo_app_data';

        // „Éá„Éº„Çø„Çí‰øùÂ≠ò
        function saveToLocalStorage() {
            try {
                const data = {
                    tasks: state.tasks,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                console.log('„Éá„Éº„Çø„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
            } catch (error) {
                console.error('‰øùÂ≠ò„Ç®„É©„Éº:', error);
                alert('„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        // „Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
        function loadFromLocalStorage() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    const data = JSON.parse(stored);
                    state.tasks = data.tasks || [];
                    console.log('„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü:', data.lastUpdated);
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                return false;
            }
        }

        // „Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢
        function clearLocalStorage() {
            if (confirm('„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        // „Ç®„ÇØ„Çπ„Éù„Éº„Éà/„Ç§„É≥„Éù„Éº„ÉàÊ©üËÉΩ

        // JSON„Ç®„ÇØ„Çπ„Éù„Éº„Éà
        function exportToJSON() {
            try {
                const data = {
                    tasks: state.tasks,
                    exportedAt: new Date().toISOString(),
                    version: '1.0'
                };
                const jsonString = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `todo-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                alert('JSON„Éï„Ç°„Ç§„É´„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„Åü');
            } catch (error) {
                console.error('„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Ç®„É©„Éº:', error);
                alert('„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        // CSV„Ç®„ÇØ„Çπ„Éù„Éº„Éà
        function exportToCSV() {
            try {
                let csv = '\uFEFF„Çø„Ç§„Éà„É´,Êó•‰ªò,ÊãÖÂΩìËÄÖ,ÂÆå‰∫ÜÁä∂ÊÖã,„Çµ„Éñ„Çø„Çπ„ÇØ\n';
                state.tasks.forEach(task => {
                    const subtasksText = task.subtasks
                        ? task.subtasks.map(st => `${st.title}(${st.assignee}:${st.completed ? 'ÂÆå‰∫Ü' : 'Êú™ÂÆå‰∫Ü'})`).join(';')
                        : '';
                    csv += `"${task.title}","${task.date}","${task.assignee}","${task.completed ? 'ÂÆå‰∫Ü' : 'Êú™ÂÆå‰∫Ü'}","${subtasksText}"\n`;
                });
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `todo-backup-${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                alert('CSV„Éï„Ç°„Ç§„É´„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„Åü');
            } catch (error) {
                console.error('„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Ç®„É©„Éº:', error);
                alert('„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        // JSON„Ç§„É≥„Éù„Éº„Éà
        function importFromJSON() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.tasks && Array.isArray(data.tasks)) {
                            if (confirm(`${data.tasks.length}‰ª∂„ÅÆ„Çø„Çπ„ÇØ„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åô„ÄÇÁèæÂú®„ÅÆ„Éá„Éº„Çø„ÅØ‰∏äÊõ∏„Åç„Åï„Çå„Åæ„Åô„Åå„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü`)) {
                                state.tasks = data.tasks;
                                saveToLocalStorage();
                                render();
                                alert('„Ç§„É≥„Éù„Éº„Éà„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü');
                            }
                        } else {
                            alert('ÁÑ°Âäπ„Å™JSON„Éï„Ç°„Ç§„É´„Åß„Åô');
                        }
                    } catch (error) {
                        console.error('„Ç§„É≥„Éù„Éº„Éà„Ç®„É©„Éº:', error);
                        alert('„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // CSV„Ç§„É≥„Éù„Éº„Éà (Á∞°ÊòìÁâà)
        function importFromCSV() {
            alert('CSV „Ç§„É≥„Éù„Éº„Éà„ÅØÁèæÂú®JSON„Ç§„É≥„Éù„Éº„Éà„Çí„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ„ÄÇ\nCSVÂΩ¢Âºè„Å∏„ÅÆÂØæÂøú„ÅØ‰ªäÂæå„ÅÆ„Ç¢„ÉÉ„Éó„Éá„Éº„Éà„ÅßËøΩÂä†‰∫àÂÆö„Åß„Åô„ÄÇ');
        }



        // „Çø„Çπ„ÇØÂàá„ÇäÊõø„Åà
        function toggleTask(id) {
            const task = state.tasks.find(t => t.id === id);
            if (!task.completed) {
                showConfetti();
            }
            task.completed = !task.completed;
            saveToLocalStorage();
            render();
        }

        // „Çµ„Éñ„Çø„Çπ„ÇØÈñ¢ÈÄ£Èñ¢Êï∞
        function toggleTaskExpanded(taskId) {
            state.expandedTasks[taskId] = !state.expandedTasks[taskId];
            render();
        }

        function addSubtask(taskId) {
            const task = state.tasks.find(t => t.id === taskId);
            if (!task) return;

            const subtaskTitle = prompt('„Çµ„Éñ„Çø„Çπ„ÇØ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:');
            if (!subtaskTitle) return;

            const assignee = prompt('ÊãÖÂΩì„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ:\n1: Â§´\n2: Â¶ª\n3: ‰∫å‰∫∫', '3');
            let assigneeName = '‰∫å‰∫∫';
            if (assignee === '1') assigneeName = 'Â§´';
            else if (assignee === '2') assigneeName = 'Â¶ª';

            const newSubtask = {
                id: Date.now(),
                title: subtaskTitle,
                completed: false,
                assignee: assigneeName
            };

            task.subtasks.push(newSubtask);
            saveToLocalStorage();
            render();
        }

        function toggleSubtask(taskId, subtaskId) {
            const task = state.tasks.find(t => t.id === taskId);
            if (!task) return;

            const subtask = task.subtasks.find(st => st.id === subtaskId);
            if (!subtask) return;

            subtask.completed = !subtask.completed;
            saveToLocalStorage();
            render();
        }

        function getSubtaskProgress(task) {
            if (!task.subtasks || task.subtasks.length === 0) return 0;
            const completed = task.subtasks.filter(st => st.completed).length;
            return Math.round((completed / task.subtasks.length) * 100);
        }

        // „Çø„Çπ„ÇØËøΩÂä†
        function addTask() {
            const { title, date, assignee } = state.formData;
            if (!title || !date) return;

            const newTask = {
                id: Date.now(),
                title,
                date,
                assignee,
                completed: false,
                subtasks: [],
                isAllDay: state.formData.isAllDay,
                startTime: state.formData.isAllDay ? null : state.formData.startTime,
                endTime: state.formData.isAllDay ? null : state.formData.endTime
            };

            state.tasks.push(newTask);
            state.formData = {
                title: '',
                date: '',
                assignee: '‰∫å‰∫∫',
                isAllDay: true,
                startTime: '09:00',
                endTime: '10:00'
            };
            state.showForm = false;
            saveToLocalStorage();
            render();
        }

        // „Ç´„É¨„É≥„ÉÄ„Éº„Å´ËøΩÂä†
        function addToCalendar(task) {
            const url = generateGoogleCalendarLink(task);
            window.open(url, '_blank');
        }

        // „Çø„ÉñÂàá„ÇäÊõø„Åà
        function switchTab(tab) {
            state.activeTab = tab;
            render();
        }

        // „Éï„Ç©„Éº„É†Ë°®Á§∫Âàá„ÇäÊõø„Åà
        function toggleForm() {
            state.showForm = !state.showForm;
            render();
        }

        // „Éï„Ç©„Éº„É†Êõ¥Êñ∞
        function updateForm(field, value) {
            state.formData[field] = value;
        }

        // „Ç´„É¨„É≥„ÉÄ„ÉºÈñ¢ÈÄ£Èñ¢Êï∞
        function changeMonth(delta) {
            const newMonth = new Date(state.currentMonth);
            newMonth.setMonth(newMonth.getMonth() + delta);
            state.currentMonth = newMonth;
            render();
        }

        function selectDate(dateStr) {
            state.selectedDate = state.selectedDate === dateStr ? null : dateStr;
            render();
        }

        function getTasksForDate(dateStr) {
            return state.tasks.filter(t => t.date === dateStr);
        }

        function getDaysInMonth(date) {
            const year = date.getFullYear();
            const month = date.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startDayOfWeek = firstDay.getDay();

            const days = [];

            // ÂâçÊúà„ÅÆÊó•‰ªò„ÅßÂüã„ÇÅ„Çã
            for (let i = 0; i < startDayOfWeek; i++) {
                days.push({ date: null, isCurrentMonth: false });
            }

            // ÂΩìÊúà„ÅÆÊó•‰ªò
            for (let i = 1; i <= daysInMonth; i++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                days.push({ date: i, dateStr, isCurrentMonth: true });
            }

            return days;
        }

        // „Çø„Çπ„ÇØ„É™„Çπ„Éà„Çø„Éñ„ÅÆ„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        function renderTaskListTab() {
            const pendingTasks = state.tasks.filter(t => !t.completed);
            const completedTasks = state.tasks.filter(t => t.completed);
            const today = new Date().toISOString().split('T')[0];

            return `
                <div class="header">
                    <h1>${icons.heart} „Çè„Åü„Åó„Åü„Å°„ÅÆTODO</h1>
                    <p>„ÅÑ„Å£„Åó„Çá„Å´È†ëÂºµ„Çç„ÅÜÔºÅ</p>
                </div>

                <div class="container">
                    ${!state.showForm ? `
                        <button class="btn btn-primary" onclick="toggleForm()">
                            ${icons.plus}
                            Êñ∞„Åó„ÅÑ„Çø„Çπ„ÇØ„ÇíËøΩÂä†
                        </button>
                    ` : ''}

                    ${state.showForm ? `
                        <div class="task-form">
                            <h2>Êñ∞„Åó„ÅÑ„Çø„Çπ„ÇØ</h2>
                            <form onsubmit="event.preventDefault(); addTask();">
                                <div class="form-group">
                                    <label>„Çø„Çπ„ÇØÂêç</label>
                                    <input 
                                        type="text" 
                                        placeholder="‰æã: Êô©„Åî„ÅØ„Çì„ÅÆÊùêÊñô„ÇíË≤∑„ÅÜ"
                                        value="${state.formData.title}"
                                        oninput="updateForm('title', this.value)"
                                        required
                                    >
                                </div>
                                <div class="form-group">
                                    <label>Êó•‰ªò</label>
                                    <input 
                                        type="date" 
                                        min="${today}"
                                        value="${state.formData.date}"
                                        oninput="updateForm('date', this.value)"
                                        required
                                    >
                                </div>
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                        <input 
                                            type="checkbox" 
                                            ${state.formData.isAllDay ? 'checked' : ''}
                                            onchange="updateForm('isAllDay', this.checked); render();"
                                            style="width: auto; cursor: pointer;"
                                        >
                                        ÁµÇÊó•„ÅÆ„Çø„Çπ„ÇØ
                                    </label>
                                </div>
                                ${!state.formData.isAllDay ? `
                                    <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                        <div>
                                            <label>ÈñãÂßãÊôÇÂàª</label>
                                            <input 
                                                type="time" 
                                                value="${state.formData.startTime}"
                                                oninput="updateForm('startTime', this.value)"
                                            >
                                        </div>
                                        <div>
                                            <label>ÁµÇ‰∫ÜÊôÇÂàª</label>
                                            <input 
                                                type="time" 
                                                value="${state.formData.endTime}"
                                                oninput="updateForm('endTime', this.value)"
                                            >
                                        </div>
                                    </div>
                                ` : ''}
                                <div class="form-group">
                                    <label>ÊãÖÂΩì</label>
                                    <div class="assignee-buttons">
                                        ${['Â§´', 'Â¶ª', '‰∫å‰∫∫'].map(option => `
                                            <button 
                                                type="button" 
                                                class="assignee-btn ${state.formData.assignee === option ? 'active' : ''}"
                                                onclick="updateForm('assignee', '${option}'); render();"
                                            >
                                                ${option}
                                            </button>
                                        `).join('')}
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="toggleForm()">
                                        „Ç≠„É£„É≥„Çª„É´
                                    </button>
                                    <button type="submit" class="btn btn-primary" style="margin: 0;">
                                        ËøΩÂä†
                                    </button>
                                </div>
                            </form>
                        </div>
                    ` : ''}

                    <h2 class="section-title">Êú™ÂÆå‰∫Ü„ÅÆ„Çø„Çπ„ÇØ</h2>
                    ${pendingTasks.length === 0 ? `
                        <div class="empty-state">
                            <div class="empty-state-icon">üéâ</div>
                            <p class="empty-state-text">„Åô„Åπ„Å¶„ÅÆ„Çø„Çπ„ÇØ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ</p>
                        </div>
                    ` : pendingTasks.map(task => renderTaskCard(task)).join('')}

                    ${completedTasks.length > 0 ? `
                        <h2 class="section-title">ÂÆå‰∫Ü„Åó„Åü„Çø„Çπ„ÇØ</h2>
                        ${completedTasks.map(task => renderTaskCard(task)).join('')}
                    ` : ''}
                </div>
            `;
        }

        // „Çø„Çπ„ÇØ„Ç´„Éº„Éâ„ÅÆ„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        function renderTaskCard(task) {
            const assigneeClass = {
                'Â§´': 'assignee-husband',
                'Â¶ª': 'assignee-wife',
                '‰∫å‰∫∫': 'assignee-both'
            }[task.assignee];

            const hasSubtasks = task.subtasks && task.subtasks.length > 0;
            const progress = getSubtaskProgress(task);
            const isExpanded = state.expandedTasks[task.id];

            return `
                <div class="task-card ${task.completed ? 'completed' : ''}">
                    <div class="task-content">
                        <div class="checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTask(${task.id})">
                            ${task.completed ? icons.check : ''}
                        </div>
                        <div class="task-info">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <h3 class="task-title ${task.completed ? 'completed' : ''}" style="margin: 0;">${task.title}</h3>
                                ${hasSubtasks ? `
                                    <button 
                                        class="subtask-toggle-btn ${isExpanded ? 'expanded' : ''}" 
                                        onclick="toggleTaskExpanded(${task.id})"
                                        title="„Çµ„Éñ„Çø„Çπ„ÇØ„Çí${isExpanded ? 'Èö†„Åô' : 'Ë°®Á§∫'}"
                                    >
                                        ${icons.chevronDown}
                                    </button>
                                ` : ''}
                            </div>
                            
                            ${hasSubtasks ? `
                                <div class="subtask-progress-container">
                                    <div class="subtask-progress-bar">
                                        <div class="subtask-progress-fill" style="width: ${progress}%"></div>
                                    </div>
                                    <span class="subtask-progress-text">${progress}%</span>
                                </div>
                            ` : ''}

                            <div class="task-meta">
                                <span class="task-date">
                                    ${icons.calendar}
                                    ${task.date}${!task.isAllDay && task.startTime && task.endTime ? ` ${task.startTime}-${task.endTime}` : ''}
                                </span>
                                <span class="task-assignee ${assigneeClass}">
                                    ${task.assignee}
                                </span>
                            </div>
                        </div>
                    </div>

                    ${isExpanded && hasSubtasks ? `
                        <div class="subtasks-container">
                            ${task.subtasks.map(subtask => {
                const subtaskAssigneeClass = {
                    'Â§´': 'assignee-husband',
                    'Â¶ª': 'assignee-wife',
                    '‰∫å‰∫∫': 'assignee-both'
                }[subtask.assignee || '‰∫å‰∫∫'];

                return `
                                <div class="subtask-item ${subtask.completed ? 'completed' : ''}">
                                    <div 
                                        class="subtask-checkbox ${subtask.completed ? 'checked' : ''}" 
                                        onclick="toggleSubtask(${task.id}, ${subtask.id})"
                                    >
                                        ${subtask.completed ? icons.check : ''}
                                    </div>
                                    <span class="subtask-title ${subtask.completed ? 'completed' : ''}">
                                        ${subtask.title}
                                    </span>
                                    <span class="subtask-assignee ${subtaskAssigneeClass}">
                                        ${subtask.assignee || '‰∫å‰∫∫'}
                                    </span>
                                </div>
                                `;
            }).join('')}
                        </div>
                    ` : ''}


                    <div class="task-actions">
                        <button class="btn-add-subtask" onclick="addSubtask(${task.id})">
                            ${icons.plus}
                            „Çµ„Éñ„Çø„Çπ„ÇØËøΩÂä†
                        </button>
                        ${!task.completed ? `
                            <button class="btn btn-calendar" onclick="addToGoogleCalendar(${JSON.stringify(task).replace(/"/g, '&quot;')})">
                                ${icons.calendar}
                                Google„Ç´„É¨„É≥„ÉÄ„Éº„Å´ËøΩÂä†
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // „Ç´„É¨„É≥„ÉÄ„Éº„Çø„Éñ„ÅÆ„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        function renderCalendarTab() {
            const year = state.currentMonth.getFullYear();
            const month = state.currentMonth.getMonth();
            const monthName = `${year}Âπ¥${month + 1}Êúà`;
            const days = getDaysInMonth(state.currentMonth);
            const weekDays = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];

            // ÈÅ∏Êäû„Åï„Çå„ÅüÊó•‰ªò„ÅÆ„Çø„Çπ„ÇØ
            const selectedTasks = state.selectedDate ? getTasksForDate(state.selectedDate) : [];

            return `
                <div class="container" style="padding-top: 24px;">
                    <h2 class="section-title">üìÖ „Ç´„É¨„É≥„ÉÄ„Éº</h2>
                    
                    <div class="calendar-widget">
                        <div class="calendar-header-controls">
                            <button class="calendar-nav-btn" onclick="changeMonth(-1)">
                                ${icons.chevronLeft}
                            </button>
                            <h3 class="calendar-month-title">${monthName}</h3>
                            <button class="calendar-nav-btn" onclick="changeMonth(1)">
                                ${icons.chevronRight}
                            </button>
                        </div>
                        
                        <div class="calendar-weekdays">
                            ${weekDays.map(day => `<div class="calendar-weekday">${day}</div>`).join('')}
                        </div>
                        
                        <div class="calendar-grid">
                            ${days.map(day => {
                if (!day.isCurrentMonth) {
                    return '<div class="calendar-day empty"></div>';
                }

                const tasks = getTasksForDate(day.dateStr);
                const hasTasks = tasks.length > 0;
                const isSelected = state.selectedDate === day.dateStr;
                const today = new Date().toISOString().split('T')[0];
                const isToday = day.dateStr === today;

                return `
                                    <div 
                                        class="calendar-day ${hasTasks ? 'has-tasks' : ''} ${isSelected ? 'selected' : ''} ${isToday ? 'today' : ''}"
                                        onclick="selectDate('${day.dateStr}')"
                                    >
                                        <span class="calendar-day-number">${day.date}</span>
                                        ${hasTasks ? '<div class="calendar-task-indicator">‚óè</div>' : ''}
                                    </div>
                                `;
            }).join('')}
                        </div>
                    </div>

                    ${state.selectedDate ? `
                        <div style="margin-top: 24px;">
                            <h3 class="section-title">${state.selectedDate} „ÅÆ„Çø„Çπ„ÇØ</h3>
                            ${selectedTasks.length === 0 ? `
                                <div class="empty-state" style="padding: 24px;">
                                    <p class="empty-state-text">„Åì„ÅÆÊó•„ÅØ„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                                </div>
                            ` : selectedTasks.map(task => {
                const assigneeClass = {
                    'Â§´': 'assignee-husband',
                    'Â¶ª': 'assignee-wife',
                    '‰∫å‰∫∫': 'assignee-both'
                }[task.assignee];

                return `
                                    <div class="task-card ${task.completed ? 'completed' : ''}">
                                        <div class="task-content">
                                            <div class="checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTask(${task.id})">
                                                ${task.completed ? icons.check : ''}
                                            </div>
                                            <div class="task-info">
                                                <h3 class="task-title ${task.completed ? 'completed' : ''}">${task.title}</h3>
                                                <div class="task-meta">
                                                    <span class="task-assignee ${assigneeClass}">
                                                        ${task.assignee}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `;
            }).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Ë®≠ÂÆö„Çø„Éñ„ÅÆ„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        function renderSettingsTab() {
            const stats = {
                total: state.tasks.length,
                completed: state.tasks.filter(t => t.completed).length,
                pending: state.tasks.filter(t => !t.completed).length,
                husband: state.tasks.filter(t => t.assignee === 'Â§´').length,
                wife: state.tasks.filter(t => t.assignee === 'Â¶ª').length,
                both: state.tasks.filter(t => t.assignee === '‰∫å‰∫∫').length
            };

            const completionRate = stats.total > 0 ? Math.round((stats.completed / stats.total) * 100) : 0;

            return `
                <div class="container" style="padding-top: 24px;">
                    <h2 class="section-title">‚öôÔ∏è Áµ±Ë®àÊÉÖÂ†±</h2>

                    <div class="stats-card">
                        <h3>„Çø„Çπ„ÇØÈÅîÊàêÁéá</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${completionRate}%"></div>
                        </div>
                        <p class="progress-text">${completionRate}%</p>
                    </div>

                    <div class="stats-card">
                        <h3>„Çø„Çπ„ÇØÊï∞</h3>
                        <div class="stats-grid">
                            <div>
                                <p class="stat-item-number">${stats.total}</p>
                                <p class="stat-item-label">ÂÖ®‰Ωì</p>
                            </div>
                            <div>
                                <p class="stat-item-number green">${stats.completed}</p>
                                <p class="stat-item-label">ÂÆå‰∫Ü</p>
                            </div>
                            <div>
                                <p class="stat-item-number orange">${stats.pending}</p>
                                <p class="stat-item-label">Êú™ÂÆå‰∫Ü</p>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card">
                        <h3>ÊãÖÂΩìÂà•</h3>
                        <div class="assignee-stats">
                            <div class="assignee-stat-item">
                                <span class="assignee-stat-label">üë® Â§´</span>
                                <span class="assignee-stat-number" style="color: #3b82f6;">${stats.husband}</span>
                            </div>
                            <div class="assignee-stat-item">
                                <span class="assignee-stat-label">üë© Â¶ª</span>
                                <span class="assignee-stat-number" style="color: #ec4899;">${stats.wife}</span>
                            </div>
                            <div class="assignee-stat-item">
                                <span class="assignee-stat-label">üíë ‰∫å‰∫∫</span>
                                <span class="assignee-stat-number" style="color: #a855f7;">${stats.both}</span>
                            </div>
                        </div>
                    </div>

                    <h2 class="section-title" style="margin-top: 32px;">üîó Google„Ç´„É¨„É≥„ÉÄ„ÉºÈÄ£Êê∫</h2>
                    
                    <div class="stats-card">
                        <h3>Ëá™ÂãïÂêåÊúü</h3>
                        <p style="font-size: 14px; color: #6b7280; margin-bottom: 16px;">
                            Google„Ç´„É¨„É≥„ÉÄ„Éº„Å®ÈÄ£Êê∫„Åô„Çã„Å®„ÄÅ„Çø„Çπ„ÇØËøΩÂä†ÊôÇ„Å´Ëá™ÂãïÁöÑ„Å´„Ç´„É¨„É≥„ÉÄ„Éº„Å´„Ç§„Éô„É≥„Éà„Åå‰ΩúÊàê„Åï„Çå„Åæ„Åô„ÄÇ
                        </p>
                        
                        ${state.isGoogleSignedIn ? `
                            <div style="padding: 16px; background: linear-gradient(135deg, #d1fae5, #a7f3d0); border-radius: 12px; margin-bottom: 16px;">
                                <p style="color: #065f46; font-weight: 600; margin-bottom: 4px;">‚úÖ ÈÄ£Êê∫Ê∏à„Åø</p>
                                <p style="color: #047857; font-size: 14px;">„Çø„Çπ„ÇØ„ÇíËøΩÂä†„Åô„Çã„Å®Ëá™ÂãïÁöÑ„Å´Google„Ç´„É¨„É≥„ÉÄ„Éº„Å´ÁôªÈå≤„Åï„Çå„Åæ„Åô„ÄÇ</p>
                            </div>
                            <button class="btn btn-delete" onclick="handleSignoutClick()">
                                ÈÄ£Êê∫„ÇíËß£Èô§
                            </button>
                        ` : `
                            <div style="padding: 16px; background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 12px; margin-bottom: 16px;">
                                <p style="color: #78350f; font-weight: 600; margin-bottom: 4px;">‚ö†Ô∏è Êú™ÈÄ£Êê∫</p>
                                <p style="color: #92400e; font-size: 14px;">Google„Ç¢„Ç´„Ç¶„É≥„Éà„Åß„Çµ„Ç§„É≥„Ç§„É≥„Åó„Å¶Ëá™ÂãïÂêåÊúü„ÇíÊúâÂäπ„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                            </div>
                            <button class="btn btn-primary" onclick="handleAuthClick()">
                                Google„Ç´„É¨„É≥„ÉÄ„Éº„Å®ÈÄ£Êê∫
                            </button>
                        `}
                    </div>

                    <h2 class="section-title" style="margin-top: 32px;">üíæ „Éá„Éº„ÇøÁÆ°ÁêÜ</h2>
                    
                    <div class="stats-card">
                        <h3>„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÉªÂæ©ÂÖÉ</h3>
                        <p style="font-size: 14px; color: #6b7280; margin-bottom: 16px;">
                            „Éá„Éº„Çø„ÅØËá™ÂãïÁöÑ„Å´„Éñ„É©„Ç¶„Ç∂„Å´‰øùÂ≠ò„Åï„Çå„Åæ„Åô„Åå„ÄÅÂøµ„ÅÆ„Åü„ÇÅ„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÇíÂèñ„Çã„Åì„Å®„Çí„Åä„Åô„Åô„ÇÅ„Åó„Åæ„Åô„ÄÇ
                        </p>
                        
                        <div style="display: grid; gap: 12px;">
                            <button class="btn btn-primary" onclick="exportToJSON()">
                                üì• JSON„Åß„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                            </button>
                            <button class="btn btn-primary" onclick="exportToCSV()">
                                üìä CSV„Åß„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                            </button>
                            <button class="btn btn-calendar" onclick="importFromJSON()">
                                üì§ JSON„Åã„Çâ„Ç§„É≥„Éù„Éº„Éà
                            </button>
                            <button class="btn-delete" onclick="clearLocalStorage()">
                                üóëÔ∏è „Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§
                            </button>
                        </div>
                    </div>

                    <h2 class="section-title" style="margin-top: 32px;">üîê „Ç¢„Ç´„Ç¶„É≥„Éà</h2>
                    
                    <div class="stats-card">
                        <h3>„É≠„Ç∞„Ç¢„Ç¶„Éà</h3>
                        <p style="font-size: 14px; color: #6b7280; margin-bottom: 16px;">
                            „É≠„Ç∞„Ç¢„Ç¶„Éà„Åô„Çã„Å®„ÄÅÊ¨°Âõû„Ç¢„ÇØ„Çª„ÇπÊôÇ„Å´„Éë„Çπ„ÉØ„Éº„Éâ„ÅÆÂÖ•Âäõ„ÅåÂøÖË¶Å„Å´„Å™„Çä„Åæ„Åô„ÄÇ
                        </p>
                        <button class="btn btn-delete" onclick="logout()">
                            üö™ „É≠„Ç∞„Ç¢„Ç¶„Éà
                        </button>
                    </div>

                    <div class="message-card">
                        <p>üíï</p>
                        <p>„ÅÑ„Å§„ÇÇ‰∫å‰∫∫„ÅßÈ†ëÂºµ„Å£„Å¶„ÅÑ„Åæ„Åô„Å≠ÔºÅ</p>
                    </div>
                </div>
            `;
        }

        // „Éú„Éà„É†„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„ÅÆ„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        function renderBottomNav() {
            return `
                <div class="bottom-nav">
                    <div class="nav-container">
                        <button class="nav-button ${state.activeTab === 'tasks' ? 'active' : ''}" onclick="switchTab('tasks')">
                            ${icons.list}
                            <span>„Çø„Çπ„ÇØ</span>
                        </button>
                        <button class="nav-button ${state.activeTab === 'calendar' ? 'active' : ''}" onclick="switchTab('calendar')">
                            ${icons.calendar}
                            <span>„Ç´„É¨„É≥„ÉÄ„Éº</span>
                        </button>
                        <button class="nav-button ${state.activeTab === 'settings' ? 'active' : ''}" onclick="switchTab('settings')">
                            ${icons.settings}
                            <span>Ë®≠ÂÆö</span>
                        </button>
                    </div>
                </div>
            `;
        }

        // „É°„Ç§„É≥„É¨„É≥„ÉÄ„É™„É≥„Ç∞Èñ¢Êï∞
        function render() {
            const app = document.getElementById('app');
            let content = '';

            if (state.activeTab === 'tasks') {
                content = renderTaskListTab();
            } else if (state.activeTab === 'calendar') {
                content = renderCalendarTab();
            } else if (state.activeTab === 'settings') {
                content = renderSettingsTab();
            }

            app.innerHTML = content + renderBottomNav();
        }

        // ÂàùÊúüÂåñÂá¶ÁêÜ
        loadFromLocalStorage();

        // Google APIÂàùÊúüÂåñ
        if (typeof gapi !== 'undefined') {
            gapiLoaded();
        }
        if (typeof google !== 'undefined') {
            gisLoaded();
        }

        // ÂàùÊúü„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        render();
    </script>
</body>

</html>